---
phase: 01-foundation-setup
plan: 02
type: execute
---

<objective>
Project klasör yapısı ve environment configuration sisteminin kurulması.

Purpose: Clean architecture için modüler yapı oluşturmak, API keys ve secrets'ı güvenli şekilde yönetmek.
Output: Organize edilmiş klasör yapısı, environment configuration, deployment scripts.
</objective>

<execution_context>
@~/.claude/skills/create-plans/workflows/execute-phase.md
@~/.claude/skills/create-plans/templates/summary.md
</execution_context>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-setup/01-01-SUMMARY.md
@functions/src/index.ts
@functions/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Project klasör yapısı oluştur</name>
  <files>functions/src/config/, functions/src/services/, functions/src/schedulers/, functions/src/utils/, functions/src/types/</files>
  <action>
    1. functions/src/ altında klasör yapısı oluştur:
       - config/ - Configuration ve constants
       - services/ - External API services (Instagram, OpenAI)
       - schedulers/ - Cloud Scheduler functions
       - utils/ - Helper utilities
       - types/ - TypeScript type definitions

    2. Her klasörde index.ts dosyası oluştur (export barrel pattern):
       - config/index.ts - export * from './firebase'; export * from './constants';
       - services/index.ts - Servisler için barrel
       - schedulers/index.ts - Schedulers için barrel
       - utils/index.ts - Utils için barrel
       - types/index.ts - Types için barrel

    3. functions/src/config/constants.ts oluştur:
       - REGION = 'europe-west1'
       - TIMEZONE = 'Europe/Istanbul'
       - SCHEDULE_TIME = '0 9 * * *' (her gün 09:00)
       - OPENAI_MODEL_VISION = 'gpt-4-vision-preview'
       - OPENAI_MODEL_DALLE = 'dall-e-3'

    4. functions/src/types/index.ts oluştur:
       - Photo interface (id, filename, url, caption, processed, etc.)
       - InstagramPost interface
       - OpenAIResponse interface
       - Config interface

    5. README güncellemesi: Proje yapısını dokümante et
  </action>
  <verify>
    - functions/src/config/, services/, schedulers/, utils/, types/ klasörleri mevcut
    - Her klasörde index.ts barrel export dosyası var
    - functions/src/config/constants.ts doğru değerlerle dolu
    - functions/src/types/index.ts interface'ler içeriyor
    - npm run build hatasız çalışıyor
  </verify>
  <done>Klasör yapısı oluşturuldu, barrel exports hazır, constants ve types tanımlandı</done>
</task>

<task type="auto">
  <name>Task 2: Environment configuration sistemi</name>
  <files>functions/src/config/firebase.ts, functions/src/config/environment.ts, .env.example</files>
  <action>
    1. functions/src/config/firebase.ts oluştur:
       - Firebase Admin SDK initialization
       - import * as admin from 'firebase-admin'
       - admin.initializeApp()
       - Export: db = admin.database(), storage = admin.storage()

    2. functions/src/config/environment.ts oluştur:
       - Firebase Functions config'den environment variables oku
       - import * as functions from 'firebase-functions'
       - Export getConfig() function:
         - openai.api_key
         - instagram.account_id
         - instagram.access_token
       - Validation: Throw error if required configs missing

    3. Proje root'a .env.example oluştur (dokümantasyon için):
       ```
       # OpenAI API
       OPENAI_API_KEY=sk-...

       # Instagram Graph API
       INSTAGRAM_ACCOUNT_ID=17841...
       INSTAGRAM_ACCESS_TOKEN=EAAxx...
       ```

    4. README.md'de environment setup talimatları:
       - firebase functions:config:set komut örnekleri
       - Her bir config değerinin ne olduğu
       - API key'leri nasıl alınır (docs/ linkler)

    5. functions/src/config/index.ts güncelle:
       - export * from './firebase'
       - export * from './environment'
       - export * from './constants'
  </action>
  <verify>
    - functions/src/config/firebase.ts mevcut ve admin SDK initialize ediyor
    - functions/src/config/environment.ts mevcut ve config validation yapıyor
    - .env.example root'ta mevcut ve değişkenler dokümante
    - README.md environment setup section güncel
    - npm run build hatasız (import errors yok)
  </verify>
  <done>Environment configuration sistemi kuruldu, Firebase Admin SDK initialized, dokümantasyon tamamlandı</done>
</task>

<task type="auto">
  <name>Task 3: Build ve deployment scripts</name>
  <files>functions/package.json, .firebaserc, firebase.json, deploy.sh</files>
  <action>
    1. functions/package.json scripts'e ekle:
       - "lint": "eslint src/**/*.ts"
       - "test": "echo \"No tests yet\" && exit 0"
       - "build": "tsc"
       - "build:watch": "tsc --watch"
       - "serve": "npm run build && firebase emulators:start --only functions"
       - "shell": "npm run build && firebase functions:shell"
       - "deploy": "npm run lint && npm run build && firebase deploy --only functions"
       - "logs": "firebase functions:log"

    2. firebase.json'da emulator settings ekle:
       ```json
       {
         "functions": {
           "source": "functions",
           "runtime": "nodejs18"
         },
         "emulators": {
           "functions": {
             "port": 5001
           },
           "ui": {
             "enabled": true,
             "port": 4000
           }
         }
       }
       ```

    3. Root'a deploy.sh script oluştur (opsiyonel, hızlı deploy için):
       ```bash
       #!/bin/bash
       set -e
       cd functions
       npm run lint
       npm run build
       cd ..
       firebase deploy --only functions
       echo "✅ Deploy completed"
       ```
       - chmod +x deploy.sh

    4. .gitignore güncellemesi kontrol:
       - functions/node_modules/
       - functions/lib/
       - .firebase/
       - *.log
       - .env (EKLE - secret'lar commit edilmesin)
  </action>
  <verify>
    - functions/package.json tüm scripts içeriyor
    - firebase.json emulator config içeriyor
    - deploy.sh executable (chmod +x edilmiş)
    - npm run lint çalışıyor (error varsa düzelt)
    - npm run build çalışıyor
    - .gitignore .env içeriyor
  </verify>
  <done>Build ve deployment scripts hazır, emulator config tamamlandı, deployment workflow ready</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Klasör yapısı organize (config/, services/, schedulers/, utils/, types/)
- [ ] Her klasörde barrel export (index.ts)
- [ ] Constants ve types tanımlı
- [ ] Firebase Admin SDK initialized
- [ ] Environment config sistemi çalışıyor
- [ ] npm run build hatasız
- [ ] npm run lint hatasız (veya warnings tolere edilebilir)
- [ ] Deployment scripts hazır
- [ ] .env.example ve dokümantasyon güncel
</verification>

<success_criteria>
- Tüm tasklar tamamlandı
- Clean architecture klasör yapısı kuruldu
- Environment configuration güvenli ve dokümante
- Build ve deployment pipeline çalışıyor
- TypeScript compilation hatasız
- Dokümantasyon güncel (README, .env.example)
- Phase 1 complete: Foundation ready for API integrations
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-setup/01-02-SUMMARY.md`:

# Phase 1 Plan 2: Project Structure & Environment Summary

**Modüler klasör yapısı kuruldu, environment configuration sistemi hazır**

## Accomplishments
- Clean architecture klasör yapısı (config/, services/, schedulers/, utils/, types/)
- Firebase Admin SDK initialized
- Environment configuration sistemi (güvenli secret management)
- Build ve deployment scripts tamamlandı

## Files Created/Modified
- `functions/src/config/` - Configuration klasörü (firebase.ts, environment.ts, constants.ts)
- `functions/src/services/` - External API services klasörü
- `functions/src/schedulers/` - Scheduler functions klasörü
- `functions/src/utils/` - Helper utilities klasörü
- `functions/src/types/` - TypeScript definitions
- `.env.example` - Environment variables dokümantasyonu
- `deploy.sh` - Deployment script
- `firebase.json` - Emulator configuration
- `README.md` - Updated with setup instructions

## Decisions Made
- Barrel export pattern kullanımı (her klasörde index.ts)
- Firebase Functions config kullanımı (environment variables için)
- Node.js 18 runtime
- ESLint integration

## Issues Encountered
[Karşılaşılan sorunlar veya "None"]

## Next Step
Phase 1 Complete! Ready for Phase 2: API Integrations
</output>
